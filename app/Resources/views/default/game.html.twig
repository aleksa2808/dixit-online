{% extends 'base.html.twig' %}

{% block body %}
    <div class="col-xs-9 col-sm-9 col-md-9 col-lg-9" id="div1" >
        <div class="well" id="myDiv">
			<canvas id="myCanvas" class='img-responsive'></canvas>
        </div>
    </div><!-- /.col-lg-6 -->
    <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3" id="div2">
        <div class="panel panel-default">
            <!-- Default panel contents -->
            <div class="panel-heading clearfix">
                <h4 class="panel-title pull-left">Chat</h4>
            </div>
            <textarea id="idChatTextArea" class="form-control" placeholder="The match has started!" rows="15" readonly></textarea>
            <div class="input-group">
                <input id="idInput" type="text" class="form-control" placeholder="chat with others">
            <span class="input-group-btn">
              <button class="btn btn-default" type="button" onclick="fClick()">Send</button>
            </span>
            </div><!-- /input-group -->
        </div>
        <a class="btn btn-danger" href="{{ path('results') }}" style="width:250px">Leave</a>
    </div>
	
    <!-- Modal -->
    <div class="modal fade" id="addDescriptionModal" tabindex="-1" role="dialog" aria-labelledby="addDescriptionModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="addDescriptionModalLabel">Add description</h4>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <input type="text" class="form-control" id="recipient-name" placeholder="type description here">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary">Submit</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ ws_client() }}

    <script src="{{ asset('js/oop.js') }}"></script>

    <script>
        var websocket = WS.connect("ws://{{ gos_web_socket_server_host }}:{{ gos_web_socket_server_port }}");
        var ses = null;

        websocket.on("socket/connect", function(session){
            ses = session;

            session.subscribe("acme/channel", function(uri, payload){
                console.log("Received message", payload.msg);

                document.getElementById("idChatTextArea").innerHTML += payload.msg.usr + ": " + payload.msg.msg + "\n";
            });
        });

        websocket.on("socket/disconnect", function(error){
            //error provides us with some insight into the disconnection: error.reason and error.code

            console.log("Disconnected for " + error.reason + " with code " + error.code);
        });

        function fClick() {
            if (null !== ses) ses.publish("acme/channel", {msg: document.getElementById("idInput").value});
        }
    </script>
{% endblock %}

